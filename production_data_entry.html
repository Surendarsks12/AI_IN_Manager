<!DOCTYPE html>
<html>
<head>
  <title>Production Log Sheet</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h2 {
      text-align: center;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table, th, td {
      border: 1px solid black;
    }

    th, td {
      padding: 8px;
      text-align: center;
    }

    input, select {
      width: 100%;
      box-sizing: border-box;
    }

    .top-info, .quick-entry, .range-entry {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .top-info label,
    .quick-entry label,
    .range-entry label {
      flex: 1;
      min-width: 200px;
    }

    button {
      padding: 10px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background-color: #45a049;
    }

    .footer-info, .signature-section {
      margin-top: 30px;
    }

    h3 {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h2>Production Log Sheet</h2>

  <div class="top-info">
    <label>Shift Date: <input type="date" id="shiftDate"></label>
    <label>Shift Start Time: <input type="time" id="shiftStart"></label>
    <label>Shift End Time: <input type="time" id="shiftEnd"></label>
    <label>Machine Name: <input type="text" id="machineName" placeholder="e.g., T-1"></label>
    <button onclick="generateRows()">Generate Sheet</button>
  </div>

  <!-- RANGE FILL ENTRY -->
  <h3>Fill Operation & Drawing for Slot Range</h3>
  <div class="range-entry">
    <label>From Slot #: <input type="number" id="slotStart" min="1"></label>
    <label>To Slot #: <input type="number" id="slotEnd" min="1"></label>
    <label>Drawing No.: <input type="text" id="rangeDrawing"></label>
    <label>Operation: <input type="text" id="rangeOperation"></label>
    <button onclick="fillRowsBySlot()">Apply to Slot Range</button>
  </div>

  <table id="logTable">
    <thead>
      <tr>
        <th>Slot No.</th>
        <th>Time In</th>
        <th>Time Out</th>
        <th>Drawing No.</th>
        <th>Operation</th>
        <th>Setting Time<br>(mins)</th>
        <th>Idle Time<br>(mins)</th>
        <th>Working Time<br>(hrs)</th>
        <th>Processed Qty</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rows will be generated -->
    </tbody>
  </table>

  <div class="footer-info">
    <label>Accepted Qty: <input type="number"></label>
    <label>Rework Qty: <input type="number"></label>
    <label>Rejection Qty: <input type="number"></label>
  </div>

  <div class="signature-section">
    <p>Productivity: _______%</p>
    <p>Approved By (Name & Signature): ________________________________</p>
  </div>

  <script>
    function generateRows() {
      const start = document.getElementById("shiftStart").value;
      const end = document.getElementById("shiftEnd").value;
      const tbody = document.querySelector("#logTable tbody");
      tbody.innerHTML = "";

      if (!start || !end) {
        alert("Please enter shift start and end time.");
        return;
      }

      const startTime = new Date(`1970-01-01T${start}:00`);
      const endTime = new Date(`1970-01-01T${end}:00`);

      if (startTime >= endTime) {
        alert("End time must be after start time.");
        return;
      }

      let currentTime = new Date(startTime);
      let slot = 1;

      while (currentTime < endTime) {
        const nextTime = new Date(currentTime.getTime() + 60 * 60 * 1000);

        const row = document.createElement("tr");

        row.innerHTML = `
          <td><input type="number" value="${slot}" readonly></td>
          <td><input type="time" value="${currentTime.toTimeString().slice(0,5)}" readonly></td>
          <td><input type="time" value="${nextTime.toTimeString().slice(0,5)}" readonly></td>
          <td><input type="text" name="drawing_no[]"></td>
          <td><input type="text" name="operation[]"></td>
          <td><input type="number" name="setting[]" min="0" step="1" onchange="calcWorking(this)"></td>
          <td><input type="number" name="idle[]" min="0" step="1" onchange="calcWorking(this)"></td>
          <td><input type="text" name="working[]" readonly></td>
          <td><input type="number" name="processed_qty[]"></td>
          <td><input type="text" name="remarks[]"></td>
        `;

        tbody.appendChild(row);
        currentTime = nextTime;
        slot++;
      }
    }

    function calcWorking(el) {
      const row = el.closest("tr");
      const settingMin = parseFloat(row.querySelector('input[name="setting[]"]').value) || 0;
      const idleMin = parseFloat(row.querySelector('input[name="idle[]"]').value) || 0;
      let workingHrs = 1 - ((settingMin + idleMin) / 60);
      if (workingHrs < 0) workingHrs = 0;
      row.querySelector('input[name="working[]"]').value = workingHrs.toFixed(2);
    }

    function fillRowsBySlot() {
      const from = parseInt(document.getElementById("slotStart").value);
      const to = parseInt(document.getElementById("slotEnd").value);
      const drawing = document.getElementById("rangeDrawing").value;
      const op = document.getElementById("rangeOperation").value;

      const rows = document.querySelectorAll("#logTable tbody tr");

      rows.forEach((row, index) => {
        const slot = index + 1;
        if (slot >= from && slot <= to) {
          row.querySelector('input[name="drawing_no[]"]').value = drawing;
          row.querySelector('input[name="operation[]"]').value = op;
        }
      });
    }
  </script>

</body>
</html>
